@{
    ViewBag.Title = "公司组织架构";
}

<ol class="breadcrumb current-position" style="margin-top:10px;">
    您的位置：
    <li>公司管理</li>
    <li>公司组织架构</li>
</ol>

<hr class="hr-grey" />

<div class="row" style="margin:0;">
    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4" style="overflow:auto;">
        @*<div class="pull-right" style="z-index: 99;" title="全部展开">
            <a href="javascript: $.fn.zTree.getZTreeObj('companyTreeShow').expandAll(true);">
                <i class="fa fa-chevron-down" style='margin-left: 5px; padding-left: 3px; border-radius:100%;'></i>
            </a>
        </div>

        <div class="pull-right" style="z-index: 99;" title="全部折叠">
            <a href="javascript: $.fn.zTree.getZTreeObj('companyTreeShow').expandAll(false);">
                <i class="fa fa-chevron-up" style='margin-left: 5px;padding-left: 3px; border-radius:100%;'></i>
            </a>
        </div>*@

        <span>公司信息展示</span>    
        <div id="companyTreeShow" class="ztree"></div>
    </div>

    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4" style="overflow:auto; border-left: 1px dashed #ddd ;">
        <span>部门信息展示</span>
        <div id="departmentTreeShow" class="ztree "></div>
    </div>

    <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4" style="overflow:auto; border-left: 1px dashed #ddd ;">
        <div class="staffDetail"></div>
        <span>员工信息展示</span>
        <div id="staffTreeShow" class="ztree"></div>
    </div>
</div>

<script type="text/javascript">
    Layout.init();

    function zTreeCompanyOnClick(event, treeId, treeNode) {
        $('.companyDetail').empty();
        $('.staffDetail').empty();

        $('.companyDetail').css({ display: "block" });
        $('.companyDetail').addClass('animated fadeIn');

        var CompanyNode = $.fn.zTree.getZTreeObj("companyTreeShow").getSelectedNodes()[0];

        var Html = "<p style='font-family:黑体;'> 名称：" + CompanyNode.name + "<br /> 地址：" + CompanyNode.address +
            "<br />备注： " + CompanyNode.remark + "<hr class='hr-grey' style='margin:2px;'/></p>";

        $(Html).appendTo('.companyDetail');

        $("#departmentTreeShow").empty();
        $("#staffTreeShow").empty();

        var CompanyID = treeNode.id;

        $.ajax({
            url: '/Department/DepartmentTree',
            type: 'get',
            data: {
                companyId: CompanyID
            },
            success: function (data) {
                function zTreeDepartmentOnClick(event, treeId, treeNode) {
                    $('.staffDetail').empty();
                    $('.staffDetail').css({ display: "block" });
                    $('.staffDetail').addClass('animated fadeIn');

                    var DepartmentNode = $.fn.zTree.getZTreeObj("departmentTreeShow").getSelectedNodes()[0];

                    var Html = "<p style='font-family:黑体;'>名称：" + DepartmentNode.name + "<br />备注：" + DepartmentNode.remark + "<hr class='hr-grey' style='margin:2px;' /></p>";

                    $(Html).appendTo('.staffDetail');
                
                    $.ajax({
                        url: '/Staff/StaffTree',
                        type: 'get',
                        data: {
                            companyId: CompanyID,
                            departmentId: treeNode.id
                        },
                        success: function (data) {
                            function zTreeStaffOnClick(event, treeId, treeNode) {
                                //弹出员工基本信息 或者跳转
                                //console.log(treeNode);
                            }

                            //function zTreeStaffOnClick(event, treeId, treeNode) {
                            //    if (treeNode.parentNode && treeNode.parentNode.id != 2) return;
                            //    var aObj = $("#" + treeNode.tId + IDMark_A);
                            //    if (treeNode.id == 21) {
                            //        var editStr = "<span class='demoIcon' id='diyBtn_" + treeNode.id + "' title='" + treeNode.name + "' onfocus='this.blur();'><span class='button icon01'></span></span>";
                            //        aObj.append(editStr);
                            //        var btn = $("#diyBtn_" + treeNode.id);
                            //        if (btn) btn.bind("click", function () { alert("diy Button for " + treeNode.name); });
                            //    } else if (treeNode.id == 22) {
                            //        var editStr = "<span class='demoIcon' id='diyBtn_" + treeNode.id + "' title='" + treeNode.name + "' onfocus='this.blur();'><span class='button icon02'></span></span>";
                            //        aObj.after(editStr);
                            //        var btn = $("#diyBtn_" + treeNode.id);
                            //        if (btn) btn.bind("click", function () { alert("diy Button for " + treeNode.name); });
                            //    } else if (treeNode.id == 23) {
                            //        var editStr = "<select class='selDemo' id='diyBtn_" + treeNode.id + "'><option value=1>1</option><option value=2>2</option><option value=3>3</option></select>";
                            //        aObj.after(editStr);
                            //        var btn = $("#diyBtn_" + treeNode.id);
                            //        if (btn) btn.bind("change", function () { alert("diy Select value=" + btn.attr("value") + " for " + treeNode.name); });
                            //    } else if (treeNode.id == 24) {
                            //        var editStr = "<span id='diyBtn_" + treeNode.id + "'>Text Demo...</span>";
                            //        aObj.after(editStr);
                            //    } else if (treeNode.id == 25) {
                            //        var editStr = "<a id='diyBtn1_" + treeNode.id + "' onclick='alert(1);return false;'>链接1</a>" +
                            //            "<a id='diyBtn2_" + treeNode.id + "' onclick='alert(2);return false;'>链接2</a>";
                            //        aObj.after(editStr);
                            //    }
                            //}

                            //$(document).ready(function () {
                            //    $.fn.zTree.init($("#treeDemo"), setting, zNodes);
                            //});




                            var StaffzNodes = data;

                            var setting = {
                                check: {
                                    enable: false,
                                    chkboxType: { "Y": "", "N": "" }
                                },
                                data: {
                                    simpleData: {
                                        enable: true
                                    }
                                },
                                callback: {
                                    onClick: zTreeStaffOnClick
                                }
                            };

                            $.fn.zTree.init($("#staffTreeShow"), setting, StaffzNodes);
                        },
                        error: function () {
                            console.log("DDDDDDDDDD");
                        }
                    })
                }

                var DepartmentzNodes = data;

                var setting = {
                    check: {
                        enable: false,
                        chkboxType: { "Y": "", "N": "" }
                    },
                    data: {
                        simpleData: {
                            enable: true
                        }
                    },
                    callback: {
                        onClick: zTreeDepartmentOnClick
                    }
                };

                $.fn.zTree.init($("#departmentTreeShow"), setting, DepartmentzNodes);
            },
            error: function () {
                console.log("DDDDDDDDDD");
            }
        })
    };

    $.ajax({
        url: '/Company/CompanyTree',
        type: 'get',
        success: function (data) {
            var zNodes = data;

            var setting = {
                check: {
                    enable: false,
                    chkboxType: { "Y": "", "N": "" }
                },
                data: {
                    simpleData: {
                        enable: true
                    }
                },
                callback: {
                    onClick: zTreeCompanyOnClick
                }
            };

            $.fn.zTree.init($("#companyTreeShow"), setting, zNodes);

        },
        error: function () {
            console.log("DDDDDD");
        }
    })
</script>