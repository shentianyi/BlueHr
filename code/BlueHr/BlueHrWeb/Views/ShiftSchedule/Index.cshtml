@using MvcPaging
@using BlueHrWeb.Helpers.View

@model IPagedList<BlueHrLib.Data.ShiftSchedule>
@{
    ViewBag.Title = "排班查询";
}

<style type="text/css">
    .fc-event{
        height: 20px !important;
        line-height: 20px !important;
    }

    .popModal{
        border-radius: 0;
        background: #34495e;
        border:none;
        z-index: 9999;
    }

    .popModal.bottomLeft:after, .popModal.bottomRight:after, .popModal.bottomCenter:after{
        border-bottom-color: #34495e;
    }
</style>

@Scripts.Render("~/bundles/fullcalendar")

<ol class="breadcrumb current-position" style="margin-top:10px;">
    您的位置：
    <li>考勤管理</li>
    <li>
        <strong>排班查询</strong>
    </li>
</ol>
<hr class="hr-grey" />
@{
    bool canDelete = MenuAuthHelper.CanShow("ShiftSchedule", "Delete");
    bool canEdit = MenuAuthHelper.CanShow("ShiftSchedule", "Edit");
    bool canCreate = MenuAuthHelper.CanShow("ShiftSchedule", "Create");
    bool canImport = MenuAuthHelper.CanShow("ShiftSchedule", "Import");
}

<div class="search">
    @* 简单搜索 *@
    <form action="/ShiftSchedule/Search" method="get">
        <div class="row" style="margin:0;">
            <div class="col-lg-3 col-md-3 col-sm-5 col-xs-5">
                <div class="marco-igroup-primary">
                    <span>员工号(模糊)</span>
                    <input type="text" name="staffNr" id="StaffNr" placeholder="员工号" value="@ViewBag.Query.StaffNr" />
                </div>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-5">
                <div class="marco-igroup-primary">
                    <span>员工号(精确)</span>
                    <input type="text" name="StaffNrAct" id="StaffNrAct" placeholder="员工号" value="@ViewBag.Query.StaffNrAct" />
                </div>
            </div>

            <div class="col-lg-6 col-md-6 col-sm-11 col-xs-11">
                <div class="marco-igroup-primary">
                    <span>排班日期</span>
                    <input type="text" name="ScheduleAtFrom" id="ScheduleAtFrom" class="datetimepicker" placeholder="开始" value="@ViewBag.Query.ScheduleAtFrom" />

                    <span style="margin-left: 5px;"> ~ </span>
                    <input type="text" name="ScheduleAtEnd" id="ScheduleAtEnd" class="datetimepicker" placeholder="结束" value="@ViewBag.Query.ScheduleAtEnd" />

                    <span class="marco-label-success" style="padding:0;">
                        <button type="submit" class="marco-btn-success" style="padding:10px; margin:0;">
                            <i class="fa fa-search"></i>
                            搜索
                        </button>
                    </span>
                </div>
            </div>

        </div>
    </form>

    @* 自定义搜索 *@
    <form action="/ShiftSchedule/AdvancedSearch" method="post">
        <div class="advanced-filter row" style="margin:0; display:none;">
            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>字段</span>
                    @*@Html.DropDownList("allTableName", ViewData["getAllTableNameList"] as IEnumerable<SelectListItem>)*@
                </div>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>条件</span>
                    @*@Html.DropDownList("searchConditions", ViewData["searchConditionsList"] as IEnumerable<SelectListItem>)*@
                </div>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>值1</span>
                    <input type="text" name="searchValueFirst" value="" />
                </div>
            </div>

            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                <div class="marco-igroup-primary">
                    <span>值2</span>
                    <input type="text" name="searchValueSecond" value="" />
                    <span><button type="submit" class="marco-btn-primary" style="margin:0;background:transparent;border-color:transparent;">确定</button></span>
                </div>
            </div>
        </div>
    </form>
</div>
<hr class="hr-primary" />

<div style="position:absolute; z-index:5;"><div id="shift_schedule_calendar"></div></div>

<div id="ShiftScheduleModal" class="approval_content" style="display:none;">
    <div class="dialogModal_header" style="background:steelblue;color:white;">
        <span>班次详情</span>
    </div>

    <div class="dialogModal_content">
        <div class="marco-nbody row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                 <div class="marco-igroup-primary">
                    <span>班次代码</span>
                    <input type="text" id="code" class="code" name="code" autofocus>
                </div>
            </div>
            <br />

            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                 <div class="marco-igroup-primary">
                    <span>班次名称</span>
                    <input type="text" id="name" class="name" name="name">
                </div>
            </div>
        </div>
    </div>
<!--
    <div class="dialogModal_footer">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 row">
            <button type="button" class="marco-btn-primary pull-right" data-dialogmodalbut="ok">
                确认
            </button>
        </div>
    </div>-->
</div>

<script type="text/javascript">
    $.ajax({
        url:'/ShiftSchedule/GetAllShiftSchedule',
        type:'get',
        success:function(data){
            console.log(data);

            $('#shift_schedule_calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'agendaMonth,agendaWeek,agendaDay,listMonth,listWeek,listDay'
                },
                views: {
                    listDay: { buttonText: '天列表' },
                    listWeek: { buttonText: '周列表' },
                    listMonth: { buttonText: '月列表' }
                },
                // weekends:false,
                defaultDate: new Date(),
                firstDay:1,
                locale: 'zh-cn',
                editable: true,
                timeFormat: 'H:mm',
                axisFormat: 'H:mm',
                weekNumbers: true,
                weekNumbersWithinDays: true,
                selectable: true,
                selectHelper: true,
                select: function(start, end) {
                    var eventData; 
                    $('#person_calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
                    
                    $('#person_calendar').fullCalendar('unselect');
                },
                dayClick: function(date, allDay, jsEvent, view){
                    // console.log(view);
                },
                eventClick: function(event, jsEvent, view) {
                    // var Html = "<ul> <li>"+event.id+"</li> <li>"+event.title+"</li> "+
                    // "<li>"+event.start+"</li><li>"+event.name+"</li><li>"+event.staffNr+"</li>"+
                    // "<li>"+event.end+"</li><li>"+event.name+"</li><li>"+event.title+"</li></ul>";

                    // $("#ShiftScheduleModal").dialogModal({
                    //    onOkBut: function () {
                    //     },
                    //     onCancelBut: function () { 
                    //     },
                    //     onLoad: function () {
                    //     },
                    //     onClose: function () {
                    //     }
                    // });

                    // console.log(view);

                    console.log(event);


                    // if(confirm("确认删除？")){
                    //     $.ajax({
                    //         url:'/Personal/DeleteSchedule',
                    //         type:'post',
                    //         data:{
                    //             id: event.id
                    //         },
                    //         success:function(data){
                    //             if(data){
                    //                 $('#person_calendar').fullCalendar('removeEvents', [event.id]);
                    //             }
                    //         },
                    //         error:function(){
                    //             Layout.popMsg("popMsg-danger", "删除失败");
                    //         }
                    //     })
                    // }
                },
                eventMouseover:function(event, jsEvent, view){
                   
                },
                events: data
            });
        },
        error:function(){
            console.log("CCVVError");
        }
    })

</script>

